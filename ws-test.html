<!DOCTYPE html>
<meta charset="utf-8"/>
<title>WebSocket Test</title>
<script src="https://unpkg.com/actioncable@5.1.4/lib/assets/compiled/action_cable.js"></script>
<script language="javascript" type="text/javascript">

    (function () {
        this.App || (this.App = {});

        // wss://ca-chat-demo.herokuapp.com/cable
        //App.cable = ActionCable.createConsumer('ws://localhost:3000/cable');
        App.cable = ActionCable.createConsumer('wss://ca-chat-demo.herokuapp.com/cable');

    }).call(this);

    App.room = App.cable.subscriptions.create('RoomChannel', {
        connected: function (data) {
            // Called when the subscription is ready for use on the server
            console.log(data)
        },

        disconnected: function () {
            // Called when the subscription has been terminated by the server
            console.log('disconnected')
        },

        received: function (data) {
            // Called when there's incoming data on the websocket for this channel
            return this.appendMessage(data);
        },

        appendMessage: function (data) {
            var parent = document.getElementById('output');
            var newChild = data.message;
            parent.insertAdjacentHTML('beforeend', newChild);
        },

        sendMessage: function(message) {
            //debugger;
            //App.room.send({message: {content: message}})
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "http://localhost:3000/messages", true);
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.send(JSON.stringify({message: {content: message}}));
        }
    });
</script>

<h2>Message client</h2>

<div id="output"></div>

<form>
    Your message: <input type="text" id="message" name="message" />
    <input type="button" value="Send message"
           onclick="App.room.sendMessage(document.getElementById('message').value);" />
</form>